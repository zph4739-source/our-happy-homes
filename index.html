<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>Yummy Family Log</title>
Â  Â Â 
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Jua&family=DM+Serif+Display&family=Noto+Sans+KR:wght@400;700&family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
Â  Â  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

Â  Â  <style>
Â  Â  Â  Â  /* [Theme: Retro 3D Cafe] */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-cream: #FFFDF5; --text-choco: #4A2c2A;
Â  Â  Â  Â  Â  Â  --accent-red: #D94844; --accent-pink: #FFD1D1; --accent-yellow: #FFD56B;
Â  Â  Â  Â  Â  Â  --border-thick: 2px solid #4A2c2A; --shadow-hard: 4px 4px 0px #4A2c2A;
Â  Â  Â  Â  Â  Â  --radius-L: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â  body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-cream); color: var(--text-choco); min-height: 100vh; overflow-x: hidden; padding-bottom: 120px; background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E"); }

Â  Â  Â  Â  .floating-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
Â  Â  Â  Â  .app-layout { max-width: 600px; margin: 0 auto; padding-bottom: 120px; position: relative; }

Â  Â  Â  Â  /* í—¤ë” */
Â  Â  Â  Â  .header { padding: 20px 24px; text-align: center; position: sticky; top: 0; z-index: 50; background: rgba(255, 253, 245, 0.95); backdrop-filter: blur(5px); border-bottom: var(--border-thick); }
Â  Â  Â  Â  .brand-title { font-family: 'DM Serif Display', serif; font-size: 32px; color: var(--accent-red); text-shadow: 2px 2px 0px var(--text-choco); letter-spacing: 1px; margin-bottom: 5px; }
Â  Â  Â  Â  .brand-sub { font-family: 'Jua', sans-serif; font-size: 16px; color: var(--text-choco); }
Â  Â  Â  Â  .my-badge { position: absolute; right: 20px; top: 25px; width: 40px; height: 40px; background: white; border: var(--border-thick); border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; box-shadow: var(--shadow-hard); }
Â  Â  Â  Â  .my-badge img { width: 100%; height: 100%; object-fit: cover; }

Â  Â  Â  Â  /* UI ì»´í¬ë„ŒíŠ¸ */
Â  Â  Â  Â  .retro-card { background: white; border: var(--border-thick); border-radius: var(--radius-L); padding: 24px; margin: 24px 20px; box-shadow: var(--shadow-hard); position: relative; transition: 0.2s; }
Â  Â  Â  Â  .btn-pop { background: var(--accent-red); color: white; border: var(--border-thick); padding: 14px 24px; border-radius: 50px; font-family: 'Jua', sans-serif; font-size: 18px; cursor: pointer; box-shadow: var(--shadow-hard); transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; }
Â  Â  Â  Â  .btn-pop:active { transform: translate(2px, 2px); box-shadow: none; background: #C0392B; }
Â  Â  Â  Â  .btn-pop.yellow { background: var(--accent-yellow); color: var(--text-choco); }
Â  Â  Â  Â  .btn-pop.gray { background: #E0E0E0; color: #555; border-color: #999; box-shadow: 2px 2px 0px #999; }
Â  Â  Â  Â  .input-retro { width: 100%; background: #FFF; border: var(--border-thick); border-radius: 16px; padding: 14px; font-size: 16px; color: var(--text-choco); outline: none; box-shadow: inset 2px 2px 5px rgba(74, 44, 42, 0.1); }

Â  Â  Â  Â  /* íƒ­ & ë„¤ë¹„ê²Œì´ì…˜ */
Â  Â  Â  Â  .tab-section { display: none; } .tab-section.active { display: block; animation: popIn 0.3s; }
Â  Â  Â  Â  @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
Â  Â  Â  Â  .nav-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; height: 70px; background: var(--text-choco); border-radius: 40px; box-shadow: 0 10px 20px rgba(74, 44, 42, 0.3); display: flex; justify-content: space-around; align-items: center; padding: 0 20px; z-index: 100; border: 2px solid white; }
Â  Â  Â  Â  .nav-item { color: rgba(255,255,255,0.5); font-size: 24px; cursor: pointer; transition: 0.3s; }
Â  Â  Â  Â  .nav-item.active { color: var(--accent-yellow); transform: translateY(-5px); }

Â  Â  Â  Â  /* ì˜ìˆ˜ì¦ ìŠ¤íƒ€ì¼ */
Â  Â  Â  Â  .receipt-paper { background: white; width: 90%; margin: 20px auto; padding: 20px; border-top: 1px solid #ddd; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; font-family: 'Nanum Gothic Coding', monospace; }
Â  Â  Â  Â  .receipt-paper::before { content: ""; position: absolute; top: -10px; left: 0; width: 100%; height: 10px; background: radial-gradient(circle at 10px 15px, transparent 10px, white 11px); background-size: 20px 20px; }
Â  Â  Â  Â  .receipt-paper::after { content: ""; position: absolute; bottom: -10px; left: 0; width: 100%; height: 10px; background: radial-gradient(circle at 10px -5px, transparent 10px, white 11px); background-size: 20px 20px; }
Â  Â  Â  Â  .receipt-title { text-align: center; font-size: 20px; border-bottom: 2px dashed #444; padding-bottom: 10px; margin-bottom: 15px; font-weight: bold; }
Â  Â  Â  Â  .shop-input-area { display: flex; gap: 10px; margin-bottom: 15px; }
Â  Â  Â  Â  .shop-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ddd; font-size: 16px; }
Â  Â  Â  Â  .shop-check { width: 20px; height: 20px; border: 2px solid var(--text-choco); border-radius: 4px; margin-right: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
Â  Â  Â  Â  .shop-check.on { background: var(--accent-red); }
Â  Â  Â  Â  .shop-del { color: #aaa; cursor: pointer; padding: 5px; }

Â  Â  Â  Â  /* ì±—ë´‡ ìŠ¤íƒ€ì¼ */
Â  Â  Â  Â  .chatbot-btn { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; background: var(--accent-red); border: var(--border-thick); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; box-shadow: var(--shadow-hard); cursor: pointer; z-index: 999; transition: 0.2s; }
Â  Â  Â  Â  .chatbot-btn:active { transform: translate(2px, 2px); box-shadow: none; }
Â  Â  Â  Â  .chat-window { position: fixed; bottom: 170px; right: 20px; width: 320px; height: 480px; background: white; border: var(--border-thick); border-radius: 20px; display: none; flex-direction: column; z-index: 999; box-shadow: 10px 10px 0px rgba(0,0,0,0.2); overflow: hidden; animation: popUp 0.3s; }
Â  Â  Â  Â  .chat-head { background: var(--accent-yellow); padding: 15px; border-bottom: var(--border-thick); font-family: 'Jua'; font-size: 18px; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #fffdf5; font-size: 14px; }
Â  Â  Â  Â  .chat-msg { margin-bottom: 10px; max-width: 85%; padding: 10px 14px; border-radius: 12px; line-height: 1.4; border: 1px solid rgba(0,0,0,0.1); word-break: keep-all; }
Â  Â  Â  Â  .msg-bot { background: white; align-self: flex-start; border-radius: 4px 12px 12px 12px; }
Â  Â  Â  Â  .msg-user { background: var(--accent-pink); align-self: flex-end; margin-left: auto; border-radius: 12px 12px 4px 12px; }
Â  Â  Â  Â  .chat-input-area { padding: 10px; border-top: var(--border-thick); display: flex; gap: 5px; background: white; }
Â  Â  Â  Â  .chat-inp { flex: 1; border: 1px solid #444; border-radius: 20px; padding: 10px; outline: none; }
Â  Â  Â  Â  .typing-indicator span { display: inline-block; width: 6px; height: 6px; background: #aaa; border-radius: 50%; margin: 0 2px; animation: typing 1s infinite; }
Â  Â  Â  Â  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; } .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
Â  Â  Â  Â  @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

Â  Â  Â  Â  /* ê¸°íƒ€ ìŠ¤íƒ€ì¼ */
Â  Â  Â  Â  .writer-scroll { display: flex; gap: 12px; margin-bottom: 20px; overflow-x: auto; padding: 5px; scrollbar-width: none; }
Â  Â  Â  Â  .radio-hidden { display: none; }
Â  Â  Â  Â  .writer-tag { padding: 8px 16px; background: white; border: var(--border-thick); border-radius: 30px; font-family: 'Jua', sans-serif; font-size: 16px; color: var(--text-choco); cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 6px; box-shadow: 2px 2px 0px rgba(74, 44, 42, 0.2); }
Â  Â  Â  Â  .radio-hidden:checked + .writer-tag { background: var(--accent-red); color: white; box-shadow: var(--shadow-hard); transform: translateY(-2px); }
Â  Â  Â  Â  .img-preview { width: 100%; border: var(--border-thick); border-radius: 16px; margin-top: 15px; overflow: hidden; position: relative; display: none; background: white; }
Â  Â  Â  Â  .feed-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px dashed #E5D0C0; padding-bottom: 10px; }
Â  Â  Â  Â  .feed-profile { display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  .fp-img { width: 45px; height: 45px; border-radius: 50%; border: var(--border-thick); object-fit: cover; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden; }
Â  Â  Â  Â  .feed-photo { padding: 10px; background: white; border: var(--border-thick); transform: rotate(-1deg); margin-bottom: 15px; box-shadow: 3px 3px 0px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .feed-photo img { width: 100%; border: 1px solid #eee; display: block; }
Â  Â  Â  Â  .act-btn { padding: 8px 12px; background: var(--bg-cream); border: 2px solid #E5D0C0; border-radius: 12px; font-weight: 700; font-size: 13px; color: var(--text-choco); display: flex; gap: 6px; align-items: center; cursor: pointer; transition: 0.2s; }

Â  Â  Â  Â  /* í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
Â  Â  Â  Â  .act-btn.liked { color: var(--accent-red); border-color: var(--accent-red); }
Â  Â  Â  Â  .act-btn.liked i.fa-heart { color: var(--accent-red); }
Â  Â  Â  Â  .heart-pop { animation: heartPop 0.4s ease; }
Â  Â  Â  Â  @keyframes heartPop { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }

Â  Â  Â  Â  /* ì¢‹ì•„ìš” í”„ë¡œí•„ í‘œì‹œ */
Â  Â  Â  Â  .like-profiles { display: flex; align-items: center; gap: 4px; margin-top: 8px; flex-wrap: wrap; }
Â  Â  Â  Â  .like-profiles .like-avatar { width: 22px; height: 22px; border-radius: 50%; border: 1.5px solid var(--accent-red); overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
Â  Â  Â  Â  .like-profiles .like-avatar img { width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â  .like-profiles .like-text { font-size: 12px; color: #888; margin-left: 4px; }

Â  Â  Â  Â  /* ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ ëŒ“ê¸€ */
Â  Â  Â  Â  .cmt-area { background: #FAFAFA; border-top: 1px solid #E5D0C0; border-radius: 0 0 16px 16px; padding: 0; margin-top: 15px; display: none; overflow: hidden; }
Â  Â  Â  Â  .cmt-area.show { display: block; }

Â  Â  Â  Â  .cmt-list { max-height: 300px; overflow-y: auto; padding: 12px 16px; }
Â  Â  Â  Â  .cmt-list::-webkit-scrollbar { width: 4px; }
Â  Â  Â  Â  .cmt-list::-webkit-scrollbar-thumb { background: #ddd; border-radius: 4px; }

Â  Â  Â  Â  .cmt-single { display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; position: relative; }
Â  Â  Â  Â  .cmt-single:not(:last-child) { border-bottom: 1px solid #f0e8df; }
Â  Â  Â  Â  .cmt-avatar { width: 32px; height: 32px; min-width: 32px; border-radius: 50%; border: 1.5px solid #E5D0C0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
Â  Â  Â  Â  .cmt-avatar img { width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â  .cmt-avatar i { font-size: 14px; color: #bbb; }
Â  Â  Â  Â  .cmt-body { flex: 1; }
Â  Â  Â  Â  .cmt-author { font-weight: 700; font-size: 13px; color: var(--text-choco); margin-right: 6px; }
Â  Â  Â  Â  .cmt-text { font-size: 13px; color: #333; line-height: 1.5; }
Â  Â  Â  Â  .cmt-time { font-size: 11px; color: #bbb; margin-top: 3px; }
Â  Â  Â  Â  .cmt-del { position: absolute; right: 0; top: 12px; border: none; background: none; color: #ccc; cursor: pointer; font-size: 12px; padding: 4px; }
Â  Â  Â  Â  .cmt-del:hover { color: var(--accent-red); }

Â  Â  Â  Â  .cmt-input-bar { display: flex; align-items: center; gap: 8px; padding: 10px 16px; border-top: 1px solid #eee; background: white; }
Â  Â  Â  Â  .cmt-input-bar .cmt-my-avatar { width: 28px; height: 28px; min-width: 28px; border-radius: 50%; border: 1.5px solid #E5D0C0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
Â  Â  Â  Â  .cmt-input-bar .cmt-my-avatar img { width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â  .cmt-input-bar input { flex: 1; border: none; outline: none; font-size: 14px; padding: 8px 0; background: transparent; color: var(--text-choco); }
Â  Â  Â  Â  .cmt-input-bar input::placeholder { color: #bbb; }
Â  Â  Â  Â  .cmt-send-btn { border: none; background: none; color: var(--accent-red); font-weight: 700; font-size: 14px; cursor: pointer; font-family: 'Jua', sans-serif; padding: 4px 8px; }
Â  Â  Â  Â  .cmt-send-btn:hover { opacity: 0.7; }

Â  Â  Â  Â  .cal-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
Â  Â  Â  Â  .cal-title { font-family: 'DM Serif Display', serif; font-size: 32px; color: var(--accent-red); }
Â  Â  Â  Â  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
Â  Â  Â  Â  .date-box { min-height: 70px; background: white; border: 2px solid #E5D0C0; border-radius: 12px; display: flex; flex-direction: column; align-items: center; padding: 5px; cursor: pointer; }
Â  Â  Â  Â  .date-box.today { background: var(--accent-yellow); border: var(--border-thick); }
Â  Â  Â  Â  .ev-badge { width: 8px; height: 8px; background: var(--accent-red); border-radius: 50%; border: 1px solid var(--text-choco); margin-top: 4px; }
Â  Â  Â  Â  .family-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 0 10px; }
Â  Â  Â  Â  .mem-card { background: white; border: var(--border-thick); border-radius: 24px; padding: 20px 10px; text-align: center; box-shadow: var(--shadow-hard); position: relative; }
Â  Â  Â  Â  .mem-pic { width: 80px; height: 80px; border-radius: 50%; border: var(--border-thick); object-fit: cover; margin-bottom: 10px; background: var(--bg-cream); display: flex; align-items: center; justify-content: center; margin-left: auto; margin-right: auto; overflow: hidden; }
Â  Â  Â  Â  .add-card { border: 2px dashed var(--text-choco); background: rgba(255,255,255,0.5); box-shadow: none; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; min-height: 200px; gap: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(74, 44, 42, 0.6); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
Â  Â  Â  Â  .modal-card { background: var(--bg-cream); width: 85%; max-width: 350px; padding: 25px; border: var(--border-thick); border-radius: var(--radius-L); box-shadow: 8px 8px 0px rgba(0,0,0,0.2); }
Â  Â  Â  Â  .modal-tit { font-family: 'Jua', sans-serif; font-size: 24px; margin-bottom: 20px; color: var(--text-choco); display:flex; align-items:center; gap:8px;}
Â  Â  Â  Â  .modal-btns { display: flex; flex-direction: column; gap: 12px; margin-top: 25px; }

Â  Â  Â  Â  @media (min-width: 768px) {
Â  Â  Â  Â  Â  Â  .app-layout { padding: 40px; }
Â  Â  Â  Â  Â  Â  .nav-dock { bottom: auto; top: 50%; left: 40px; transform: translateY(-50%); width: 70px; height: 300px; flex-direction: column; padding: 30px 0; }
Â  Â  Â  Â  Â  Â  .family-grid { grid-template-columns: repeat(3, 1fr); }
Â  Â  Â  Â  Â  Â  .chatbot-btn { right: 50px; bottom: 50px; }
Â  Â  Â  Â  Â  Â  .chat-window { right: 50px; bottom: 120px; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="floating-bg">
Â  Â  Â  Â  <i class="fa-solid fa-star floater obj-1"></i>
Â  Â  Â  Â  <i class="fa-solid fa-circle floater obj-2"></i>
Â  Â  Â  Â  <i class="fa-solid fa-cloud floater obj-3"></i>
Â  Â  Â  Â  <i class="fa-solid fa-sparkles floater obj-4"></i>
Â  Â  </div>

Â  Â  <div class="app-layout">
Â  Â  Â  Â  <header class="header">
Â  Â  Â  Â  Â  Â  <div class="brand-title">Yummy Family</div>
Â  Â  Â  Â  Â  Â  <div class="brand-sub">ìš°ë¦¬ ê°€ì¡±ì˜ ë§›ìˆëŠ” ì¼ìƒ ğŸ’</div>
Â  Â  Â  Â  Â  Â  <div class="my-badge" id="headerProfile"><i class="fa-solid fa-user"></i></div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main id="mainContent">
Â  Â  Â  Â  Â  Â  <div id="feed" class="tab-section active">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="retro-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-family:'Jua'; font-size:20px; margin-bottom:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fa-solid fa-pen-fancy" style="color:var(--accent-red);"></i> ì˜¤ëŠ˜ì˜ ì¶”ì–µ ê¸°ë¡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="writer-scroll" id="writerChips">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:14px; color:#aaa; padding:10px;">ë¡œë”© ì¤‘... (ê°€ì¡±ì„ ë¨¼ì € ë“±ë¡í•˜ì„¸ìš”!)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="postContent" class="input-retro" style="min-height:100px; resize:none;" placeholder="ì˜¤ëŠ˜ ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”? ğŸ°"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="imagePreviewBox" class="img-preview">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="imagePreview" src="">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-x" onclick="clearImage()"><i class="fa-solid fa-times"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="imageInput" style="font-size:24px; color:var(--text-choco); cursor:pointer;"><i class="fa-regular fa-image"></i></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageSelect(event)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnPost" class="btn-pop" style="width:auto; padding:10px 30px;" onclick="addPost()">ì—…ë¡œë“œ!</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="feed-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; margin-top:30px; display:none;" id="moreBtnBox">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pop yellow" style="width:auto;" onclick="loadMorePosts()">ë” ë³´ê¸° ğŸ‘‡</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="calendar" class="tab-section">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="retro-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cal-top">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cal-arrow" onclick="moveMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="month-display" class="cal-title"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cal-arrow" onclick="moveMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cal-grid" style="margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="day-label" style="color:var(--accent-red)">ì¼</div><div class="day-label">ì›”</div><div class="day-label">í™”</div><div class="day-label">ìˆ˜</div><div class="day-label">ëª©</div><div class="day-label">ê¸ˆ</div><div class="day-label">í† </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="calendar-days" class="cal-grid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="shopping" class="tab-section">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-paper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-title">ğŸ›’ ì¥ë³´ê¸° ë¦¬ìŠ¤íŠ¸</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="shopInput" class="input-retro" placeholder="ì‚´ ê²ƒ ì…ë ¥ (ì˜ˆ: ìš°ìœ )" onkeydown="if(event.key==='Enter')addShopItem()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pop" style="width:auto;" onclick="addShopItem()">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="shopList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; margin-top:20px; font-size:12px; color:#aaa;">*** THANK YOU ***</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="family" class="tab-section">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; margin-bottom:20px; font-family:'Jua'; font-size:28px;">ìš°ë¦¬ ê°€ì¡± ë©¤ë²„ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="family-container" class="family-grid"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>

Â  Â  Â  Â  <nav class="nav-dock">
Â  Â  Â  Â  Â  Â  <div class="nav-item active" onclick="changeTab('feed', this)"><i class="fa-solid fa-house"></i></div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeTab('calendar', this)"><i class="fa-solid fa-calendar-days"></i></div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeTab('shopping', this)"><i class="fa-solid fa-cart-shopping"></i></div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeTab('family', this)"><i class="fa-solid fa-users"></i></div>
Â  Â  Â  Â  </nav>
Â  Â  </div>

Â  Â  <div class="chatbot-btn" onclick="toggleChat()"><i class="fa-solid fa-robot"></i></div>
Â  Â  <div class="chat-window" id="chatWindow">
Â  Â  Â  Â  <div class="chat-head">ğŸ’ AI ì²´ë¦¬ <i class="fa-solid fa-times" style="cursor:pointer;" onclick="toggleChat()"></i></div>
Â  Â  Â  Â  <div class="chat-body" id="chatBody">
Â  Â  Â  Â  Â  Â  <div class="chat-msg msg-bot">
Â  Â  Â  Â  Â  Â  Â  Â  ì•ˆë…•í•˜ì„¸ìš”! ìš°ë¦¬ ê°€ì¡± ì „ìš© AI <b>ì²´ë¦¬</b>ì…ë‹ˆë‹¤! ğŸ’<br>
Â  Â  Â  Â  Â  Â  Â  Â  ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”! (ì˜ˆ: "ì˜¤ëŠ˜ ì €ë… ë­ ë¨¹ì§€?")
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chat-input-area">
Â  Â  Â  Â  Â  Â  <input type="text" id="chatInput" class="chat-inp" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeydown="if(event.key==='Enter')sendChat()">
Â  Â  Â  Â  Â  Â  <button class="btn-pop" style="width:auto; padding:5px 15px; font-size:14px;" onclick="sendChat()">ì „ì†¡</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="eventModal" class="modal-bg">
Â  Â  Â  Â  <div class="modal-card">
Â  Â  Â  Â  Â  Â  <div class="modal-tit">ğŸ“… ì¼ì • ê¸°ë¡</div>
Â  Â  Â  Â  Â  Â  <p id="modalDateDisplay" style="text-align:center; font-weight:bold; margin-bottom:20px; color:var(--text-choco);"></p>
Â  Â  Â  Â  Â  Â  <ul id="eventList" style="list-style:none; margin-bottom:20px; padding:0;"></ul>
Â  Â  Â  Â  Â  Â  <input type="hidden" id="eventDate">
Â  Â  Â  Â  Â  Â  <input type="text" id="eventTitle" class="input-retro" placeholder="ì¼ì • ë‚´ìš©" onkeydown="if(event.key==='Enter') saveEvent()">
Â  Â  Â  Â  Â  Â  <div class="modal-btns">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pop gray" onclick="closeModal('eventModal')">ë‹«ê¸°</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pop" onclick="saveEvent()">ì €ì¥</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="familyModal" class="modal-bg">
Â  Â  Â  Â  <div class="modal-card">
Â  Â  Â  Â  Â  Â  <div class="modal-tit">ğŸ’ ê°€ì¡± ì¶”ê°€</div>
Â  Â  Â  Â  Â  Â  <div style="text-align:center; margin-bottom:20px;">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="famImgInput" style="display:inline-block; cursor:pointer;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="famImgPreview" style="width:100px; height:100px; border-radius:50%; background:var(--bg-cream); border:var(--border-thick); display:flex; align-items:center; justify-content:center; overflow:hidden;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fa-solid fa-camera" style="font-size:30px; color:var(--text-choco);"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="famImgInput" accept="image/*" style="display:none;" onchange="handleFamImgSelect(event)">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <input type="text" id="famRole" class="input-retro" placeholder="ì—­í•  (ì˜ˆ: ì•„ë¹ )" style="margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  <input type="text" id="famName" class="input-retro" placeholder="ì´ë¦„ (ì„ íƒ)" style="margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  <input type="text" id="famDesc" class="input-retro" placeholder="í•œ ë§ˆë”” ì†Œê°œ">
Â  Â  Â  Â  Â  Â  <div class="modal-btns">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pop gray" onclick="closeModal('familyModal')">ì·¨ì†Œ</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnSaveFam" class="btn-pop" onclick="saveFam()">ì¶”ê°€</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // ğŸ”‘ API Key
Â  Â  Â  Â  const GEMINI_API_KEY = "AIzaSyDCJvEiVEYrCI5x7_YDOipEG5mUFZVKmkI";

Â  Â  Â  Â  // Firebase Config
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyCokmBJyH6xGaB42u_ScP6k7ghEVxTZSio",
Â  Â  Â  Â  Â  Â  authDomain: "our-family-home.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "our-family-home",
Â  Â  Â  Â  Â  Â  storageBucket: "our-family-home.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "446464856858",
Â  Â  Â  Â  Â  Â  appId: "1:446464856858:web:344f2c83aeda0ea9ae52a3"
Â  Â  Â  Â  };
Â  Â  Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = firebase.firestore();

Â  Â  Â  Â  function compressImage(f,mW,cb){const r=new FileReader();r.onload=e=>{const i=new Image();i.onload=()=>{const c=document.createElement('canvas');let w=i.width,h=i.height;if(w>mW){h*=mW/w;w=mW;}c.width=w;c.height=h;c.getContext('2d').drawImage(i,0,0,w,h);cb(c.toDataURL('image/jpeg',0.5));};i.src=e.target.result;};r.readAsDataURL(f);}

Â  Â  Â  Â  /* --- [AI í•µì‹¬] ì˜¤í”„ë¼ì¸ ë°±ì—… ë‘ë‡Œ (ê·œì¹™ ê¸°ë°˜) --- */
Â  Â  Â  Â  const recipes = {
Â  Â  Â  Â  Â  Â  "ë–¡ë³¶ì´": ["ë–¡", "ì–´ë¬µ", "ëŒ€íŒŒ", "ê³ ì¶”ì¥", "ì„¤íƒ•"],
Â  Â  Â  Â  Â  Â  "ê¹€ì¹˜ì°Œê°œ": ["ê¹€ì¹˜", "ë¼ì§€ê³ ê¸°", "ë‘ë¶€", "ëŒ€íŒŒ"],
Â  Â  Â  Â  Â  Â  "ëœì¥ì°Œê°œ": ["ëœì¥", "í˜¸ë°•", "ë‘ë¶€", "ì–‘íŒŒ"],
Â  Â  Â  Â  Â  Â  "ë¯¸ì—­êµ­": ["ë¯¸ì—­", "ì†Œê³ ê¸°", "ì°¸ê¸°ë¦„"],
Â  Â  Â  Â  Â  Â  "ì¹´ë ˆ": ["ì¹´ë ˆê°€ë£¨", "ê°ì", "ë‹¹ê·¼", "ì–‘íŒŒ"],
Â  Â  Â  Â  Â  Â  "ë¼ë©´": ["ë¼ë©´", "ê³„ë€", "íŒŒ"],
Â  Â  Â  Â  Â  Â  "ë¹„ë¹”ë°¥": ["ì½©ë‚˜ë¬¼", "ì‹œê¸ˆì¹˜", "ê³ ì¶”ì¥", "ê³„ë€", "ì°¸ê¸°ë¦„"]
Â  Â  Â  Â  };

Â  Â  Â  Â  function fallbackAI(text) {
Â  Â  Â  Â  Â  Â  let reply = "ìŒ.. ê·¸ê±´ ì œê°€ ì˜ ëª¨ë¥´ëŠ” ë‚´ìš©ì´ì—ìš”. 'ë–¡ë³¶ì´ ì¬ë£Œ'ë‚˜ 'ì¼ì • ì¶”ê°€'ë¼ê³  ë§í•´ë³´ì„¸ìš”!";
Â  Â  Â  Â  Â  Â  let action = null;
Â  Â  Â  Â  Â  Â  for (const food in recipes) {
Â  Â  Â  Â  Â  Â  Â  Â  if (text.includes(food)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action = { action: "add_shopping_multi", items: recipes[food] };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reply = `ğŸ‘¨â€ğŸ³ (ì˜¤í”„ë¼ì¸ ëª¨ë“œ) <b>${food}</b> ì¬ë£Œë¥¼ ì¥ë³´ê¸°ì— ë‹´ì•˜ì–´ìš”!`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!action && (text.includes("ì¥ë³´ê¸°") || text.includes("ë‹´ì•„") || text.includes("ì¶”ê°€"))) {
Â  Â  Â  Â  Â  Â  Â  Â  const item = text.replace("ì¥ë³´ê¸°","").replace("ì¶”ê°€","").replace("í•´ì¤˜","").replace("ë‹´ì•„ì¤˜","").replace("ì—","").trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(item) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action = { action: "add_shopping", item: item };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reply = `ğŸ›’ (ì˜¤í”„ë¼ì¸ ëª¨ë“œ) <b>${item}</b> ì¶”ê°€ ì™„ë£Œ!`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (text.includes("ì¼ì •")) {
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  let date = today.toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  if(text.includes("ë‚´ì¼")) { today.setDate(today.getDate()+1); date = today.toISOString().split('T')[0]; }
Â  Â  Â  Â  Â  Â  Â  Â  const title = text.replace("ì¼ì •","").replace("ì¶”ê°€","").replace("í•´ì¤˜","").replace("ë‚´ì¼","").replace("ì˜¤ëŠ˜","").trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(title) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action = { action: "add_event", date: date, title: title };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reply = `ğŸ“… (ì˜¤í”„ë¼ì¸ ëª¨ë“œ) <b>${date}</b>ì— <b>${title}</b> ë“±ë¡!`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return { text: reply, action: action };
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- [AI í•µì‹¬] ìë™ ëª¨ë¸ ìš°íšŒ ì‹œìŠ¤í…œ --- */
Â  Â  Â  Â  const AI_MODELS = ["gemini-2.5-flash", "gemini-2.0-flash", "gemini-1.5-flash"];

Â  Â  Â  Â  async function sendChat() {
Â  Â  Â  Â  Â  Â  const input = document.getElementById('chatInput');
Â  Â  Â  Â  Â  Â  const text = input.value.trim();
Â  Â  Â  Â  Â  Â  if(!text) return;
Â  Â  Â  Â  Â  Â  appendMessage(text, 'user');
Â  Â  Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  Â  Â  const loadingId = appendLoading();

Â  Â  Â  Â  Â  Â  const systemPrompt = `
Â  Â  Â  Â  Â  Â  Â  Â  ë„ˆëŠ” 'ì²´ë¦¬'ë¼ëŠ” ê°€ì¡± AI ë¹„ì„œì•¼. ì¹œê·¼í•œ ë°˜ë§ë¡œ ëŒ€ë‹µí•´.
Â  Â  Â  Â  Â  Â  Â  Â  [ê¸°ëŠ¥ ì‹¤í–‰ ê·œì¹™]
Â  Â  Â  Â  Â  Â  Â  Â  1. ì¼ì • ì¶”ê°€: {"action":"add_event", "date":"YYYY-MM-DD", "title":"ë‚´ìš©"} (ì˜¤ëŠ˜:${new Date().toISOString().split('T')[0]})
Â  Â  Â  Â  Â  Â  Â  Â  2. ì¥ë³´ê¸° ì¶”ê°€: {"action":"add_shopping", "item":"ë¬¼ê±´"}
Â  Â  Â  Â  Â  Â  Â  Â  3. ì—¬ëŸ¬ê°œ ì¶”ê°€: {"action":"add_shopping_multi", "items":["ë¬¼ê±´1", "ë¬¼ê±´2"]}
Â  Â  Â  Â  Â  Â  Â  Â  4. ê·¸ ì™¸: ê·¸ëƒ¥ í…ìŠ¤íŠ¸ ëŒ€í™”.
Â  Â  Â  Â  Â  Â  Â  Â  ì¤‘ìš”: "ë¹„ë¹”ë°¥ ì¬ë£Œ ì¶”ê°€" ê°™ì€ ìš”ì²­ì´ ì˜¤ë©´ "ë¹„ë¹”ë°¥ ì¬ë£Œ"ë¼ê³  ì“°ì§€ ë§ê³  ì‹¤ì œ ì¬ë£Œ(ì½©ë‚˜ë¬¼, ì‹œê¸ˆì¹˜ ë“±)ë¥¼ itemsì— ë‹´ì•„ì¤˜.
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  let aiText = "";
Â  Â  Â  Â  Â  Â  let success = false;
Â  Â  Â  Â  Â  Â  for (const model of AI_MODELS) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${GEMINI_API_KEY}`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST', headers: {'Content-Type': 'application/json'},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: systemPrompt + "\nUser: " + text }] }] })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (res.status === 429) throw new Error("Too Many Requests");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!res.ok) throw new Error("API Error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiText = data.candidates[0].content.parts[0].text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  success = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`Model ${model} failed (${e.message}), trying next...`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  document.getElementById(loadingId).remove();

Â  Â  Â  Â  Â  Â  if(!success) {
Â  Â  Â  Â  Â  Â  Â  Â  const fb = fallbackAI(text);
Â  Â  Â  Â  Â  Â  Â  Â  aiText = fb.text;
Â  Â  Â  Â  Â  Â  Â  Â  if (fb.action) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fb.action.action === 'add_shopping_multi') fb.action.items.forEach(i => db.collection("family_shopping").add({ text: i, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (fb.action.action === 'add_shopping') db.collection("family_shopping").add({ text: fb.action.item, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (fb.action.action === 'add_event') db.collection("family_events").add({ date: fb.action.date, title: fb.action.title, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  appendMessage(aiText, 'bot');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (aiText.includes('{"action"')) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const match = aiText.match(/\{"action":.*?\}/) || aiText.match(/\{"action":.*?\]\}/);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (match) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cmd = JSON.parse(match[0]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiText = aiText.replace(match[0], "");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (cmd.action === 'add_event') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  db.collection("family_events").add({ date: cmd.date, title: cmd.title, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiText += `\nğŸ“… <b>${cmd.date}</b>ì— <b>${cmd.title}</b> ì¼ì • ë“±ë¡ ì™„ë£Œ!`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (cmd.action === 'add_shopping') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  db.collection("family_shopping").add({ text: cmd.item, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiText += `\nğŸ›’ <b>${cmd.item}</b> ì¶”ê°€ ì™„ë£Œ!`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (cmd.action === 'add_shopping_multi') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cmd.items.forEach(i => db.collection("family_shopping").add({ text: i, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiText += `\nğŸ›’ <b>${cmd.items.join(", ")}</b> ëª¨ë‘ ë‹´ì•˜ì–´!`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {}
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  appendMessage(aiText, 'bot');
Â  Â  Â  Â  }

Â  Â  Â  Â  function appendMessage(t, s) {
Â  Â  Â  Â  Â  Â  const box = document.getElementById('chatBody');
Â  Â  Â  Â  Â  Â  box.innerHTML += `<div class="chat-msg msg-${s}">${marked.parse(t)}</div>`;
Â  Â  Â  Â  Â  Â  box.scrollTop = box.scrollHeight;
Â  Â  Â  Â  }
Â  Â  Â  Â  function appendLoading() {
Â  Â  Â  Â  Â  Â  const id = 'load-'+Date.now();
Â  Â  Â  Â  Â  Â  document.getElementById('chatBody').innerHTML += `<div class="chat-msg msg-bot typing-indicator" id="${id}"><span></span><span></span><span></span></div>`;
Â  Â  Â  Â  Â  Â  return id;
Â  Â  Â  Â  }
Â  Â  Â  Â  function toggleChat() {Â 
Â  Â  Â  Â  Â  Â  const w = document.getElementById('chatWindow'); w.style.display = w.style.display === 'flex' ? 'none' : 'flex';Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- ê°€ì¡±, ìº˜ë¦°ë”, ì¥ë³´ê¸° --- */
Â  Â  Â  Â  let familyData=[], selectedRole="";
Â  Â  Â  Â  function loadFamily(){
Â  Â  Â  Â  Â  Â  db.collection("family_members").orderBy("timestamp").onSnapshot(snap=>{
Â  Â  Â  Â  Â  Â  Â  Â  familyData=[]; const con=document.getElementById('family-container'); const chips=document.getElementById('writerChips');
Â  Â  Â  Â  Â  Â  Â  Â  con.innerHTML=""; chips.innerHTML="";Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(snap.empty) chips.innerHTML=`<div style="padding:10px;font-size:14px;color:#aaa;">ê°€ì¡±ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  snap.forEach(doc=>{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const d=doc.data(); familyData.push({id:doc.id,...d});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imgHtml=d.imageUrl?`<img src="${d.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`:`<i class="fa-solid fa-user" style="font-size:30px;"></i>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  con.innerHTML+=`<div class="mem-card"><button class="del-btn" onclick="delFamily('${doc.id}')" style="position:absolute;top:10px;right:10px;border:none;background:none;color:#999;"><i class="fa-solid fa-times"></i></button><div class="mem-pic">${imgHtml}</div><div class="mem-role">${d.role}</div><div class="mem-desc">${d.desc||'Yummy!'}</div></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chk=selectedRole===d.role?'checked':'';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chips.innerHTML+=`<input type="radio" name="auth" id="c-${doc.id}" class="radio-hidden" value="${d.role}" onchange="selAuth(this)" ${chk}><label for="c-${doc.id}" class="writer-tag"><div style="width:24px;height:24px;border-radius:50%;overflow:hidden;background:#eee;border:1px solid #444;display:flex;align-items:center;justify-content:center;">${d.imageUrl?`<img src="${d.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`:`<i class="fa-solid fa-user" style="font-size:12px;"></i>`}</div> ${d.role}</label>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  con.innerHTML+=`<div class="mem-card add-card" onclick="openFamModal()"><i class="fa-solid fa-plus-circle" style="font-size:40px;"></i><span style="font-family:'Jua';font-size:18px;">ê°€ì¡± ì¶”ê°€</span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  updateHeaderProf();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function selAuth(rd){ selectedRole=rd.value; updateHeaderProf(); }
Â  Â  Â  Â  function updateHeaderProf(){Â 
Â  Â  Â  Â  Â  Â  const hp=document.getElementById('headerProfile');Â 
Â  Â  Â  Â  Â  Â  if(!selectedRole){ hp.innerHTML=`<i class="fa-solid fa-user"></i>`; return; }
Â  Â  Â  Â  Â  Â  const mem=familyData.find(m=>m.role===selectedRole);
Â  Â  Â  Â  Â  Â  if(mem&&mem.imageUrl) hp.innerHTML=`<img src="${mem.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`;
Â  Â  Â  Â  Â  Â  else hp.innerHTML=`<i class="fa-solid fa-user"></i>`;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- í—¬í¼: ê°€ì¡± ë©¤ë²„ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸° --- */
Â  Â  Â  Â  function getMemberImg(role) {
Â  Â  Â  Â  Â  Â  const mem = familyData.find(m => m.role === role);
Â  Â  Â  Â  Â  Â  if (mem && mem.imageUrl) return `<img src="${mem.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`;
Â  Â  Â  Â  Â  Â  return `<i class="fa-solid fa-user" style="font-size:14px;color:#bbb;"></i>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  function getMyAvatarHtml() {
Â  Â  Â  Â  Â  Â  if (!selectedRole) return `<i class="fa-solid fa-user" style="font-size:12px;color:#bbb;"></i>`;
Â  Â  Â  Â  Â  Â  return getMemberImg(selectedRole);
Â  Â  Â  Â  }

Â  Â  Â  Â  let feedImg=null;
Â  Â  Â  Â  function handleImageSelect(e){if(e.target.files[0])compressImage(e.target.files[0],500,d=>{feedImg=d;document.getElementById('imagePreview').src=d;document.getElementById('imagePreviewBox').style.display='block';});}
Â  Â  Â  Â  function clearImage(){feedImg=null;document.getElementById('imageInput').value='';document.getElementById('imagePreviewBox').style.display='none';}
Â  Â  Â  Â  function addPost(){
Â  Â  Â  Â  Â  Â  if(!selectedRole) return alert("ëˆ„ê°€ ê¸€ì„ ì“°ë‚˜ìš”? ê°€ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");Â 
Â  Â  Â  Â  Â  Â  const txt=document.getElementById('postContent').value, btn=document.getElementById('btnPost');
Â  Â  Â  Â  Â  Â  if(!txt&&!feedImg) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");Â 
Â  Â  Â  Â  Â  Â  const mem=familyData.find(m=>m.role===selectedRole); btn.disabled=true; btn.innerText="ì €ì¥ ì¤‘...";
Â  Â  Â  Â  Â  Â  db.collection("family_posts").add({
Â  Â  Â  Â  Â  Â  Â  Â  author: selectedRole,
Â  Â  Â  Â  Â  Â  Â  Â  authorImg: mem ? mem.imageUrl : null,
Â  Â  Â  Â  Â  Â  Â  Â  content: txt,
Â  Â  Â  Â  Â  Â  Â  Â  imageUrl: feedImg,
Â  Â  Â  Â  Â  Â  Â  Â  likedBy: [],Â  Â // ë³€ê²½: likes ìˆ«ì ëŒ€ì‹  likedBy ë°°ì—´
Â  Â  Â  Â  Â  Â  Â  Â  comments: [],
Â  Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(()=>{document.getElementById('postContent').value='';clearImage();btn.disabled=false;btn.innerText="ì—…ë¡œë“œ!"; window.scrollTo(0,0);})
Â  Â  Â  Â  Â  Â  .catch(e=>{alert("ì‹¤íŒ¨!");btn.disabled=false;btn.innerText="ì—…ë¡œë“œ!";});
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- ì¢‹ì•„ìš” (í”„ë¡œí•„ë‹¹ 1íšŒ) --- */
Â  Â  Â  Â  function likePost(id, likedByArr) {
Â  Â  Â  Â  Â  Â  if (!selectedRole) return alert("í”„ë¡œí•„ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");
Â  Â  Â  Â  Â  Â  const likedBy = likedByArr || [];
Â  Â  Â  Â  Â  Â  const alreadyLiked = likedBy.includes(selectedRole);

Â  Â  Â  Â  Â  Â  if (alreadyLiked) {
Â  Â  Â  Â  Â  Â  Â  Â  // ì¢‹ì•„ìš” ì·¨ì†Œ
Â  Â  Â  Â  Â  Â  Â  Â  db.collection("family_posts").doc(id).update({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likedBy: firebase.firestore.FieldValue.arrayRemove(selectedRole)
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // ì¢‹ì•„ìš” ì¶”ê°€
Â  Â  Â  Â  Â  Â  Â  Â  db.collection("family_posts").doc(id).update({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likedBy: firebase.firestore.FieldValue.arrayUnion(selectedRole)
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  // í•˜íŠ¸ íŒ ì• ë‹ˆë©”ì´ì…˜
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.querySelector(`[data-like-id="${id}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  if (btn) { btn.classList.add('heart-pop'); setTimeout(() => btn.classList.remove('heart-pop'), 400); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- í”¼ë“œ ë Œë”ë§ --- */
Â  Â  Â  Â  function loadFeed(){
Â  Â  Â  Â  Â  Â  db.collection("family_posts").limit(20).onSnapshot(snap=>{
Â  Â  Â  Â  Â  Â  Â  Â  const con=document.getElementById('feed-container'); con.innerHTML=""; let posts=[];Â 
Â  Â  Â  Â  Â  Â  Â  Â  snap.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = d.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í•˜ìœ„ í˜¸í™˜: ì˜›ë‚  likes ìˆ«ì â†’ likedBy ë°°ì—´ ë³€í™˜
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.likedBy && typeof data.likes === 'number' && data.likes > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.likedBy = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  posts.push({id: d.id, ...data});
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  posts.sort((a,b)=>(b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
Â  Â  Â  Â  Â  Â  Â  Â  if(posts.length===0) con.innerHTML=`<div style="text-align:center;padding:40px;color:#aaa;">ì²« ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”! ğŸ’</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  posts.forEach(d=>{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pImg=d.authorImg?`<div class="fp-img"><img src="${d.authorImg}" style="width:100%;height:100%;object-fit:cover;"></div>`:`<div class="fp-img"><i class="fa-solid fa-user"></i></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iHtml=d.imageUrl?`<div class="feed-photo"><img src="${d.imageUrl}"></div>`:'';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¢‹ì•„ìš” ë°ì´í„°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const likedBy = d.likedBy || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const likeCount = likedBy.length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iLiked = selectedRole && likedBy.includes(selectedRole);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const likedClass = iLiked ? 'liked' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const heartIcon = iLiked ? 'fa-solid fa-heart' : 'fa-regular fa-heart';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ í”„ë¡œí•„ ì•„ë°”íƒ€ë“¤
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let likeProfilesHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (likeCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likeProfilesHtml = '<div class="like-profiles">';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likedBy.slice(0, 5).forEach(role => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likeProfilesHtml += `<div class="like-avatar">${getMemberImg(role)}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const names = likedBy.join(', ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likeProfilesHtml += `<span class="like-text"><b>${names}</b>ë‹˜ì´ ì¢‹ì•„í•©ë‹ˆë‹¤</span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ëŒ“ê¸€ ë Œë”ë§ (ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cmtsHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (d.comments && d.comments.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.comments.forEach((c, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cmtAvatar = getMemberImg(c.author);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cmtsHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cmt-single">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cmt-avatar">${cmtAvatar}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cmt-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="cmt-author">${c.author}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="cmt-text">${c.text}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cmt-del" onclick="delComment('${d.id}', ${idx})" title="ì‚­ì œ"><i class="fa-solid fa-times"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í˜„ì¬ ì„ íƒëœ í”„ë¡œí•„ì˜ ì•„ë°”íƒ€
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const myAvatar = getMyAvatarHtml();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì‹œê°„ í‘œì‹œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeStr = d.timestamp ? new Date(d.timestamp.seconds * 1000).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' }) : 'ë°©ê¸ˆ';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const safelikedBy = JSON.stringify(likedBy).replace(/'/g, "\\'").replace(/"/g, '&quot;');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  con.innerHTML+=`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="retro-card" style="padding-bottom:0; overflow:hidden;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feed-head">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feed-profile">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${pImg}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="fp-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="font-size:15px;">${d.author}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:12px; color:#999;">${timeStr}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="delPost('${d.id}')" style="border:none;background:none;color:#bbb;font-size:16px;"><i class="fa-solid fa-ellipsis"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feed-text" style="margin-bottom:12px; font-size:15px; line-height:1.6;">${d.content}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${iHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feed-actions" style="display:flex; gap:12px; padding:8px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="act-btn ${likedClass}" data-like-id="${d.id}" onclick='likePost("${d.id}", ${JSON.stringify(likedBy)})'>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="${heartIcon}" style="font-size:18px;"></i> ${likeCount > 0 ? likeCount : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="act-btn" onclick="toggleCmt('${d.id}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fa-regular fa-comment" style="font-size:18px;"></i> ${d.comments ? d.comments.length : 0}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${likeProfilesHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="cmt-${d.id}" class="cmt-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cmt-list">${cmtsHtml || '<div style="text-align:center;padding:20px;color:#ccc;font-size:13px;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ì–´ìš”</div>'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cmt-input-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cmt-my-avatar">${myAvatar}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="cInp-${d.id}" placeholder="ëŒ“ê¸€ ë‹¬ê¸°..." onkeydown="if(event.key==='Enter')addCmt('${d.id}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cmt-send-btn" onclick="addCmt('${d.id}')">ê²Œì‹œ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function delPost(id){if(confirm("ì´ ê²Œì‹œë¬¼ì„ ì‚­ì œí• ê¹Œìš”?"))db.collection("family_posts").doc(id).delete();}
Â  Â  Â  Â  function toggleCmt(id){document.getElementById(`cmt-${id}`).classList.toggle('show');}
Â  Â  Â  Â Â 
Â  Â  Â  Â  function addCmt(id){
Â  Â  Â  Â  Â  Â  if (!selectedRole) return alert("í”„ë¡œí•„ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");
Â  Â  Â  Â  Â  Â  const t = document.getElementById(`cInp-${id}`).value.trim();Â 
Â  Â  Â  Â  Â  Â  if(!t) return;Â 
Â  Â  Â  Â  Â  Â  db.collection("family_posts").doc(id).update({
Â  Â  Â  Â  Â  Â  Â  Â  comments: firebase.firestore.FieldValue.arrayUnion({ author: selectedRole, text: t, time: Date.now() })
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById(`cInp-${id}`).value = '';
Â  Â  Â  Â  }

Â  Â  Â  Â  function delComment(postId, cmtIndex) {
Â  Â  Â  Â  Â  Â  if (!confirm("ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”?")) return;
Â  Â  Â  Â  Â  Â  db.collection("family_posts").doc(postId).get().then(doc => {
Â  Â  Â  Â  Â  Â  Â  Â  if (doc.exists) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const comments = doc.data().comments || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comments.splice(cmtIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  db.collection("family_posts").doc(postId).update({ comments: comments });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  let curDate=new Date(), events=[], curModDate=null;
Â  Â  Â  Â  function loadCal(){
Â  Â  Â  Â  Â  Â  const y=curDate.getFullYear(), m=curDate.getMonth(); document.getElementById('month-display').innerText=`${m+1}ì›”`;
Â  Â  Â  Â  Â  Â  const f=new Date(y,m,1), l=new Date(y,m+1,0), con=document.getElementById('calendar-days'); con.innerHTML="";
Â  Â  Â  Â  Â  Â  for(let i=0;i<f.getDay();i++)con.innerHTML+=`<div></div>`;
Â  Â  Â  Â  Â  Â  for(let i=1;i<=l.getDate();i++){
Â  Â  Â  Â  Â  Â  Â  Â  const dStr=`${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`, evs=events.filter(e=>e.date===dStr), hasEv=evs.length?`<div class="ev-badge"></div>`:'', tdy=new Date().toDateString()===new Date(y,m,i).toDateString()?'today':'';
Â  Â  Â  Â  Â  Â  Â  Â  con.innerHTML+=`<div class="date-box ${tdy}" onclick="openEvModal('${dStr}')"><span class="date-num">${i}</span>${hasEv}</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function moveMonth(n){curDate.setMonth(curDate.getMonth()+n);loadCal();}
Â  Â  Â  Â  function openEvModal(d){curModDate=d; document.getElementById('modalDateDisplay').innerText=d; renderEvList(); document.getElementById('eventModal').style.display='flex';}
Â  Â  Â  Â  function renderEvList(){const el=document.getElementById('eventList'), evs=events.filter(e=>e.date===curModDate); el.innerHTML=evs.length?"":"<li style='text-align:center;color:#999;'>ì¼ì • ì—†ìŒ</li>"; evs.forEach(e=>el.innerHTML+=`<li style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #ccc;"><span>${e.title}</span><i class="fa-solid fa-times" style="color:red;cursor:pointer;" onclick="delEv('${e.id}')"></i></li>`);}
Â  Â  Â  Â  function saveEvent(){const t=document.getElementById('eventTitle').value; if(curModDate&&t) db.collection("family_events").add({date:curModDate,title:t,timestamp:firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{document.getElementById('eventTitle').value='';closeModal('eventModal');});}
Â  Â  Â  Â  function delEv(id){if(confirm("ì‚­ì œ?"))db.collection("family_events").doc(id).delete();}
Â  Â  Â  Â  db.collection("family_events").onSnapshot(s=>{events=[];s.forEach(d=>events.push({id:d.id,...d.data()}));loadCal();if(curModDate)renderEvList();});

Â  Â  Â  Â  let famImg=null; function closeModal(id){document.getElementById(id).style.display='none';famImg=null;curModDate=null;}
Â  Â  Â  Â  function openFamModal(){document.getElementById('familyModal').style.display='flex';}
Â  Â  Â  Â  function handleFamImgSelect(e){if(e.target.files[0])compressImage(e.target.files[0],500,d=>{famImg=d;document.getElementById('famImgPreview').innerHTML=`<img src="${d}" style="width:100%;height:100%;object-fit:cover;">`;});}
Â  Â  Â  Â  function saveFam(){
Â  Â  Â  Â  Â  Â  const r=document.getElementById('famRole').value, n=document.getElementById('famName').value, d=document.getElementById('famDesc').value; if(!r)return alert("ì—­í•  ì…ë ¥!"); const btn=document.getElementById('btnSaveFam'); btn.disabled=true; btn.innerText="ì €ì¥ ì¤‘...";
Â  Â  Â  Â  Â  Â  db.collection("family_members").add({role:r,name:n,desc:d,imageUrl:famImg,timestamp:firebase.firestore.FieldValue.serverTimestamp()})
Â  Â  Â  Â  Â  Â  .then(()=>{closeModal('familyModal');btn.disabled=false;btn.innerText="ì¶”ê°€";document.getElementById('famRole').value='';document.getElementById('famName').value='';document.getElementById('famDesc').value='';document.getElementById('famImgInput').value='';document.getElementById('famImgPreview').innerHTML=`<i class="fa-solid fa-camera" style="font-size:30px;color:var(--text-choco);"></i>`;})
Â  Â  Â  Â  Â  Â  .catch(e=>{alert("ì˜¤ë¥˜!");btn.disabled=false;btn.innerText="ì¶”ê°€";});
Â  Â  Â  Â  }
Â  Â  Â  Â  function delFamily(id){if(confirm("ì‚­ì œ?"))db.collection("family_members").doc(id).delete();}

Â  Â  Â  Â  function loadShopping() {
Â  Â  Â  Â  Â  Â  db.collection("family_shopping").orderBy("timestamp", "desc").onSnapshot(snap => {
Â  Â  Â  Â  Â  Â  Â  Â  const list = document.getElementById('shopList');
Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = "";
Â  Â  Â  Â  Â  Â  Â  Â  snap.forEach(doc => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const d = doc.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const checkedClass = d.checked ? "checked" : "";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const checkColor = d.checked ? "on" : "";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item ${checkedClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-check ${checkColor}" onclick="toggleShop('${doc.id}', ${!d.checked})"><i class="fa-solid fa-check" style="color:white; font-size:12px;"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${d.text}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fa-solid fa-times shop-del" onclick="delShop('${doc.id}')"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function addShopItem() {
Â  Â  Â  Â  Â  Â  const inp = document.getElementById('shopInput');
Â  Â  Â  Â  Â  Â  if(inp.value.trim()) {
Â  Â  Â  Â  Â  Â  Â  Â  db.collection("family_shopping").add({ text: inp.value, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
Â  Â  Â  Â  Â  Â  Â  Â  inp.value = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function toggleShop(id, stat) { db.collection("family_shopping").doc(id).update({ checked: stat }); }
Â  Â  Â  Â  function delShop(id) { if(confirm("ì‚­ì œ?")) db.collection("family_shopping").doc(id).delete(); }

Â  Â  Â  Â  window.changeTab=function(id,el){document.querySelectorAll('.tab-section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));if(el)el.classList.add('active');window.scrollTo(0,0);}
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadFeed(); loadCal(); loadFamily(); loadShopping();
Â  Â  </script>
</body>
</html>
