<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Yummy Family Log</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFFDF5">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1685/1685822.png">
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiWXVtbXkgRmFtaWx5Iiwic2hvcnRfbmFtZSI6Ill1bW15Iiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNGRkZERjUiLCJ0aGVtZV9jb2xvciI6IiNGRkZERjUiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9jZG4taWNvbnS1wbmcuZmxhdGljb24uY29tLzUxMi8xNjg1LzE2ODU4MjIucG5nIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">

    <link href="https://fonts.googleapis.com/css2?family=Jua&family=DM+Serif+Display&family=Noto+Sans+KR:wght@400;700&family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        /* [Theme: Retro 3D Cafe] */
        :root {
            --bg-cream: #FFFDF5; --text-choco: #4A2c2A;
            --accent-red: #D94844; --accent-pink: #FFD1D1; --accent-yellow: #FFD56B;
            --border-thick: 2px solid #4A2c2A; --shadow-hard: 4px 4px 0px #4A2c2A;
            --radius-L: 20px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-cream); color: var(--text-choco); min-height: 100vh; overflow-x: hidden; padding-bottom: 120px; background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E"); }

        .floating-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .app-layout { max-width: 600px; margin: 0 auto; padding-bottom: 120px; position: relative; }

        /* í—¤ë” */
        .header { padding: 20px 24px; text-align: center; position: sticky; top: 0; z-index: 50; background: rgba(255, 253, 245, 0.95); backdrop-filter: blur(5px); border-bottom: var(--border-thick); }
        .brand-title { font-family: 'DM Serif Display', serif; font-size: 32px; color: var(--accent-red); text-shadow: 2px 2px 0px var(--text-choco); letter-spacing: 1px; margin-bottom: 5px; }
        .brand-sub { font-family: 'Jua', sans-serif; font-size: 16px; color: var(--text-choco); }
        .my-badge { position: absolute; right: 20px; top: 25px; width: 40px; height: 40px; background: white; border: var(--border-thick); border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; box-shadow: var(--shadow-hard); cursor: pointer; }
        .my-badge img { width: 100%; height: 100%; object-fit: cover; }

        /* UI ì»´í¬ë„ŒíŠ¸ */
        .retro-card { background: white; border: var(--border-thick); border-radius: var(--radius-L); padding: 24px; margin: 24px 20px; box-shadow: var(--shadow-hard); position: relative; transition: 0.2s; }
        .btn-pop { background: var(--accent-red); color: white; border: var(--border-thick); padding: 14px 24px; border-radius: 50px; font-family: 'Jua', sans-serif; font-size: 18px; cursor: pointer; box-shadow: var(--shadow-hard); transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; }
        .btn-pop:active { transform: translate(2px, 2px); box-shadow: none; background: #C0392B; }
        .btn-pop.yellow { background: var(--accent-yellow); color: var(--text-choco); }
        .btn-pop.gray { background: #E0E0E0; color: #555; border-color: #999; box-shadow: 2px 2px 0px #999; }
        /* ì„¤ì¹˜ ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ */
        .btn-pop.install { background: #333; color: white; border-color: #333; }
        .input-retro { width: 100%; background: #FFF; border: var(--border-thick); border-radius: 16px; padding: 14px; font-size: 16px; color: var(--text-choco); outline: none; box-shadow: inset 2px 2px 5px rgba(74, 44, 42, 0.1); }

        /* íƒ­ & ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-section { display: none; } .tab-section.active { display: block; animation: popIn 0.3s; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .nav-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; height: 70px; background: var(--text-choco); border-radius: 40px; box-shadow: 0 10px 20px rgba(74, 44, 42, 0.3); display: flex; justify-content: space-around; align-items: center; padding: 0 20px; z-index: 100; border: 2px solid white; }
        .nav-item { color: rgba(255,255,255,0.5); font-size: 24px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--accent-yellow); transform: translateY(-5px); }

        /* ì˜ìˆ˜ì¦ ìŠ¤íƒ€ì¼ */
        .receipt-paper { background: white; width: 90%; margin: 20px auto; padding: 20px; border-top: 1px solid #ddd; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; font-family: 'Nanum Gothic Coding', monospace; }
        .receipt-paper::before { content: ""; position: absolute; top: -10px; left: 0; width: 100%; height: 10px; background: radial-gradient(circle at 10px 15px, transparent 10px, white 11px); background-size: 20px 20px; }
        .receipt-paper::after { content: ""; position: absolute; bottom: -10px; left: 0; width: 100%; height: 10px; background: radial-gradient(circle at 10px -5px, transparent 10px, white 11px); background-size: 20px 20px; }
        .receipt-title { text-align: center; font-size: 20px; border-bottom: 2px dashed #444; padding-bottom: 10px; margin-bottom: 15px; font-weight: bold; }
        .shop-input-area { display: flex; gap: 10px; margin-bottom: 15px; }
        .shop-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ddd; font-size: 16px; }
        .shop-check { width: 20px; height: 20px; border: 2px solid var(--text-choco); border-radius: 4px; margin-right: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .shop-check.on { background: var(--accent-red); }
        .shop-del { color: #aaa; cursor: pointer; padding: 5px; }

        /* ì±—ë´‡ ìŠ¤íƒ€ì¼ */
        .chatbot-btn { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; background: var(--accent-red); border: var(--border-thick); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; box-shadow: var(--shadow-hard); cursor: pointer; z-index: 999; transition: 0.2s; }
        .chatbot-btn:active { transform: translate(2px, 2px); box-shadow: none; }
        .chat-window { position: fixed; bottom: 170px; right: 20px; width: 320px; height: 480px; background: white; border: var(--border-thick); border-radius: 20px; display: none; flex-direction: column; z-index: 999; box-shadow: 10px 10px 0px rgba(0,0,0,0.2); overflow: hidden; animation: popUp 0.3s; }
        .chat-head { background: var(--accent-yellow); padding: 15px; border-bottom: var(--border-thick); font-family: 'Jua'; font-size: 18px; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #fffdf5; font-size: 14px; }
        .chat-msg { margin-bottom: 10px; max-width: 85%; padding: 10px 14px; border-radius: 12px; line-height: 1.4; border: 1px solid rgba(0,0,0,0.1); word-break: keep-all; }
        .msg-bot { background: white; align-self: flex-start; border-radius: 4px 12px 12px 12px; }
        .msg-user { background: var(--accent-pink); align-self: flex-end; margin-left: auto; border-radius: 12px 12px 4px 12px; }
        .chat-input-area { padding: 10px; border-top: var(--border-thick); display: flex; gap: 5px; background: white; }
        .chat-inp { flex: 1; border: 1px solid #444; border-radius: 20px; padding: 10px; outline: none; }
        .typing-indicator span { display: inline-block; width: 6px; height: 6px; background: #aaa; border-radius: 50%; margin: 0 2px; animation: typing 1s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; } .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* ê¸°íƒ€ ìŠ¤íƒ€ì¼ */
        .writer-scroll { display: flex; gap: 12px; margin-bottom: 20px; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .radio-hidden { display: none; }
        .writer-tag { padding: 8px 16px; background: white; border: var(--border-thick); border-radius: 30px; font-family: 'Jua', sans-serif; font-size: 16px; color: var(--text-choco); cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 6px; box-shadow: 2px 2px 0px rgba(74, 44, 42, 0.2); }
        .radio-hidden:checked + .writer-tag { background: var(--accent-red); color: white; box-shadow: var(--shadow-hard); transform: translateY(-2px); }
        .img-preview { width: 100%; border: var(--border-thick); border-radius: 16px; margin-top: 15px; overflow: hidden; position: relative; display: none; background: white; }
        .feed-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px dashed #E5D0C0; padding-bottom: 10px; }
        .feed-profile { display: flex; align-items: center; gap: 10px; }
        .fp-img { width: 45px; height: 45px; border-radius: 50%; border: var(--border-thick); object-fit: cover; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .feed-photo { padding: 10px; background: white; border: var(--border-thick); transform: rotate(-1deg); margin-bottom: 15px; box-shadow: 3px 3px 0px rgba(0,0,0,0.1); }
        .feed-photo img { width: 100%; border: 1px solid #eee; display: block; }
        .act-btn { padding: 8px 12px; background: var(--bg-cream); border: 2px solid #E5D0C0; border-radius: 12px; font-weight: 700; font-size: 13px; color: var(--text-choco); display: flex; gap: 6px; align-items: center; cursor: pointer; transition: 0.2s; }

        .act-btn.liked { color: var(--accent-red); border-color: var(--accent-red); }
        .act-btn.liked i.fa-heart { color: var(--accent-red); }
        .heart-pop { animation: heartPop 0.4s ease; }
        @keyframes heartPop { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }

        .like-profiles { display: flex; align-items: center; gap: 4px; margin-top: 8px; flex-wrap: wrap; }
        .like-profiles .like-avatar { width: 22px; height: 22px; border-radius: 50%; border: 1.5px solid var(--accent-red); overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
        .like-profiles .like-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .like-profiles .like-text { font-size: 12px; color: #888; margin-left: 4px; }

        .cmt-area { background: #FAFAFA; border-top: 1px solid #E5D0C0; border-radius: 0 0 16px 16px; padding: 0; margin-top: 15px; display: none; overflow: hidden; }
        .cmt-area.show { display: block; }
        .cmt-list { max-height: 300px; overflow-y: auto; padding: 12px 16px; }
        .cmt-single { display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; position: relative; }
        .cmt-single:not(:last-child) { border-bottom: 1px solid #f0e8df; }
        .cmt-avatar { width: 32px; height: 32px; min-width: 32px; border-radius: 50%; border: 1.5px solid #E5D0C0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
        .cmt-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .cmt-body { flex: 1; }
        .cmt-author { font-weight: 700; font-size: 13px; color: var(--text-choco); margin-right: 6px; }
        .cmt-text { font-size: 13px; color: #333; line-height: 1.5; }
        .cmt-del { position: absolute; right: 0; top: 12px; border: none; background: none; color: #ccc; cursor: pointer; font-size: 12px; padding: 4px; }
        .cmt-input-bar { display: flex; align-items: center; gap: 8px; padding: 10px 16px; border-top: 1px solid #eee; background: white; }
        .cmt-input-bar .cmt-my-avatar { width: 28px; height: 28px; min-width: 28px; border-radius: 50%; border: 1.5px solid #E5D0C0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
        .cmt-input-bar .cmt-my-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .cmt-input-bar input { flex: 1; border: none; outline: none; font-size: 14px; padding: 8px 0; background: transparent; color: var(--text-choco); }
        .cmt-send-btn { border: none; background: none; color: var(--accent-red); font-weight: 700; font-size: 14px; cursor: pointer; font-family: 'Jua', sans-serif; padding: 4px 8px; }

        .cal-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cal-title { font-family: 'DM Serif Display', serif; font-size: 32px; color: var(--accent-red); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
        .date-box { min-height: 70px; background: white; border: 2px solid #E5D0C0; border-radius: 12px; display: flex; flex-direction: column; align-items: center; padding: 5px; cursor: pointer; }
        .date-box.today { background: var(--accent-yellow); border: var(--border-thick); }
        .ev-badge { width: 8px; height: 8px; background: var(--accent-red); border-radius: 50%; border: 1px solid var(--text-choco); margin-top: 4px; }
        .family-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 0 10px; }
        .mem-card { background: white; border: var(--border-thick); border-radius: 24px; padding: 20px 10px; text-align: center; box-shadow: var(--shadow-hard); position: relative; }
        .mem-pic { width: 80px; height: 80px; border-radius: 50%; border: var(--border-thick); object-fit: cover; margin-bottom: 10px; background: var(--bg-cream); display: flex; align-items: center; justify-content: center; margin-left: auto; margin-right: auto; overflow: hidden; }
        .add-card { border: 2px dashed var(--text-choco); background: rgba(255,255,255,0.5); box-shadow: none; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; min-height: 200px; gap: 10px; }
        
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(74, 44, 42, 0.6); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-card { background: var(--bg-cream); width: 85%; max-width: 350px; padding: 25px; border: var(--border-thick); border-radius: var(--radius-L); box-shadow: 8px 8px 0px rgba(0,0,0,0.2); }
        .modal-tit { font-family: 'Jua', sans-serif; font-size: 24px; margin-bottom: 20px; color: var(--text-choco); display:flex; align-items:center; gap:8px;}
        .modal-btns { display: flex; flex-direction: column; gap: 12px; margin-top: 25px; }

        @media (min-width: 768px) {
            .app-layout { padding: 40px; }
            .nav-dock { bottom: auto; top: 50%; left: 40px; transform: translateY(-50%); width: 70px; height: 300px; flex-direction: column; padding: 30px 0; }
            .family-grid { grid-template-columns: repeat(3, 1fr); }
            .chatbot-btn { right: 50px; bottom: 50px; }
            .chat-window { right: 50px; bottom: 120px; }
        }
    </style>
</head>
<body>
    <div class="floating-bg">
        <i class="fa-solid fa-star floater obj-1"></i>
        <i class="fa-solid fa-circle floater obj-2"></i>
        <i class="fa-solid fa-cloud floater obj-3"></i>
        <i class="fa-solid fa-sparkles floater obj-4"></i>
    </div>

    <div class="app-layout">
        <header class="header">
            <div class="brand-title">Yummy Family</div>
            <div class="brand-sub">ìš°ë¦¬ ê°€ì¡±ì˜ ë§›ìˆëŠ” ì¼ìƒ ğŸ’</div>
            <div class="my-badge" id="headerProfile" onclick="openFamModal()"><i class="fa-solid fa-user"></i></div>
        </header>

        <main id="mainContent">
            <div id="feed" class="tab-section active">
                <div class="retro-card">
                    <div style="font-family:'Jua'; font-size:20px; margin-bottom:15px;">
                        <i class="fa-solid fa-pen-fancy" style="color:var(--accent-red);"></i> ì˜¤ëŠ˜ì˜ ì¶”ì–µ ê¸°ë¡
                    </div>
                    <div class="writer-scroll" id="writerChips">
                        <div style="font-size:14px; color:#aaa; padding:10px;">ë¡œë”© ì¤‘... (ê°€ì¡±ì„ ë¨¼ì € ë“±ë¡í•˜ì„¸ìš”!)</div>
                    </div>
                    <textarea id="postContent" class="input-retro" style="min-height:100px; resize:none;" placeholder="ì˜¤ëŠ˜ ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”? ğŸ°"></textarea>
                    <div id="imagePreviewBox" class="img-preview">
                        <img id="imagePreview" src="">
                        <button class="btn-x" onclick="clearImage()"><i class="fa-solid fa-times"></i></button>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px;">
                        <label for="imageInput" style="font-size:24px; color:var(--text-choco); cursor:pointer;"><i class="fa-regular fa-image"></i></label>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageSelect(event)">
                        <button id="btnPost" class="btn-pop" style="width:auto; padding:10px 30px;" onclick="addPost()">ì—…ë¡œë“œ!</button>
                    </div>
                </div>
                <div id="feed-container"></div>
                <div style="text-align:center; margin-top:30px; display:none;" id="moreBtnBox">
                    <button class="btn-pop yellow" style="width:auto;" onclick="loadMorePosts()">ë” ë³´ê¸° ğŸ‘‡</button>
                </div>
            </div>

            <div id="calendar" class="tab-section">
                <div class="retro-card">
                    <div class="cal-top">
                        <button class="cal-arrow" onclick="moveMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                        <div id="month-display" class="cal-title"></div>
                        <button class="cal-arrow" onclick="moveMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                    <div class="cal-grid" style="margin-bottom:10px;">
                        <div class="day-label" style="color:var(--accent-red)">ì¼</div><div class="day-label">ì›”</div><div class="day-label">í™”</div><div class="day-label">ìˆ˜</div><div class="day-label">ëª©</div><div class="day-label">ê¸ˆ</div><div class="day-label">í† </div>
                    </div>
                    <div id="calendar-days" class="cal-grid"></div>
                </div>
            </div>

            <div id="shopping" class="tab-section">
                <div class="receipt-paper">
                    <div class="receipt-title">ğŸ›’ ì¥ë³´ê¸° ë¦¬ìŠ¤íŠ¸</div>
                    <div class="shop-input-area">
                        <input type="text" id="shopInput" class="input-retro" placeholder="ì‚´ ê²ƒ ì…ë ¥ (ì˜ˆ: ìš°ìœ )" onkeydown="if(event.key==='Enter')addShopItem()">
                        <button class="btn-pop" style="width:auto;" onclick="addShopItem()">+</button>
                    </div>
                    <div id="shopList"></div>
                    <div style="text-align:center; margin-top:20px; font-size:12px; color:#aaa;">*** THANK YOU ***</div>
                </div>
            </div>

            <div id="family" class="tab-section">
                <div style="text-align:center; margin-bottom:20px; font-family:'Jua'; font-size:28px;">ìš°ë¦¬ ê°€ì¡± ë©¤ë²„ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                <div id="family-container" class="family-grid"></div>
            </div>
        </main>

        <nav class="nav-dock">
            <div class="nav-item active" onclick="changeTab('feed', this)"><i class="fa-solid fa-house"></i></div>
            <div class="nav-item" onclick="changeTab('calendar', this)"><i class="fa-solid fa-calendar-days"></i></div>
            <div class="nav-item" onclick="changeTab('shopping', this)"><i class="fa-solid fa-cart-shopping"></i></div>
            <div class="nav-item" onclick="changeTab('family', this)"><i class="fa-solid fa-users"></i></div>
        </nav>
    </div>

    <div class="chatbot-btn" onclick="toggleChat()"><i class="fa-solid fa-robot"></i></div>
    <div class="chat-window" id="chatWindow">
        <div class="chat-head">ğŸ’ AI ì²´ë¦¬ <i class="fa-solid fa-times" style="cursor:pointer;" onclick="toggleChat()"></i></div>
        <div class="chat-body" id="chatBody">
            <div class="chat-msg msg-bot">
                ì•ˆë…•í•˜ì„¸ìš”! ìš°ë¦¬ ê°€ì¡± ì „ìš© AI <b>ì²´ë¦¬</b>ì…ë‹ˆë‹¤! ğŸ’<br>
                ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”! (ì˜ˆ: "ì˜¤ëŠ˜ ì €ë… ë­ ë¨¹ì§€?")
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" class="chat-inp" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeydown="if(event.key==='Enter')sendChat()">
            <button class="btn-pop" style="width:auto; padding:5px 15px; font-size:14px;" onclick="sendChat()">ì „ì†¡</button>
        </div>
    </div>

    <div id="eventModal" class="modal-bg">
        <div class="modal-card">
            <div class="modal-tit">ğŸ“… ì¼ì • ê¸°ë¡</div>
            <p id="modalDateDisplay" style="text-align:center; font-weight:bold; margin-bottom:20px; color:var(--text-choco);"></p>
            <ul id="eventList" style="list-style:none; margin-bottom:20px; padding:0;"></ul>
            <input type="hidden" id="eventDate">
            <input type="text" id="eventTitle" class="input-retro" placeholder="ì¼ì • ë‚´ìš©" onkeydown="if(event.key==='Enter') saveEvent()">
            <div class="modal-btns">
                <button class="btn-pop gray" onclick="closeModal('eventModal')">ë‹«ê¸°</button>
                <button class="btn-pop" onclick="saveEvent()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div id="familyModal" class="modal-bg">
        <div class="modal-card">
            <div class="modal-tit">ğŸ’ ì„¤ì • ë° ê°€ì¡±</div>
            
            <button id="btnInstallApp" class="btn-pop install" style="margin-bottom:20px; display:none;" onclick="installApp()">
                <i class="fa-solid fa-download"></i> ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°
            </button>

            <div style="text-align:center; margin-bottom:20px;">
                <label for="famImgInput" style="display:inline-block; cursor:pointer;">
                    <div id="famImgPreview" style="width:100px; height:100px; border-radius:50%; background:var(--bg-cream); border:var(--border-thick); display:flex; align-items:center; justify-content:center; overflow:hidden;">
                        <i class="fa-solid fa-camera" style="font-size:30px; color:var(--text-choco);"></i>
                    </div>
                </label>
                <input type="file" id="famImgInput" accept="image/*" style="display:none;" onchange="handleFamImgSelect(event)">
            </div>
            <input type="text" id="famRole" class="input-retro" placeholder="ì—­í•  (ì˜ˆ: ì•„ë¹ )" style="margin-bottom:10px;">
            <input type="text" id="famName" class="input-retro" placeholder="ì´ë¦„ (ì„ íƒ)" style="margin-bottom:10px;">
            <input type="text" id="famDesc" class="input-retro" placeholder="í•œ ë§ˆë”” ì†Œê°œ">
            <div class="modal-btns">
                <button class="btn-pop gray" onclick="closeModal('familyModal')">ì·¨ì†Œ</button>
                <button id="btnSaveFam" class="btn-pop" onclick="saveFam()">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”‘ API Key
        const GEMINI_API_KEY = "AIzaSyDCJvEiVEYrCI5x7_YDOipEG5mUFZVKmkI";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCokmBJyH6xGaB42u_ScP6k7ghEVxTZSio",
            authDomain: "our-family-home.firebaseapp.com",
            projectId: "our-family-home",
            storageBucket: "our-family-home.firebasestorage.app",
            messagingSenderId: "446464856858",
            appId: "1:446464856858:web:344f2c83aeda0ea9ae52a3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function compressImage(f,mW,cb){const r=new FileReader();r.onload=e=>{const i=new Image();i.onload=()=>{const c=document.createElement('canvas');let w=i.width,h=i.height;if(w>mW){h*=mW/w;w=mW;}c.width=w;c.height=h;c.getContext('2d').drawImage(i,0,0,w,h);cb(c.toDataURL('image/jpeg',0.5));};i.src=e.target.result;};r.readAsDataURL(f);}

        /* --- [ì•± ì„¤ì¹˜ ë¡œì§ ì¶”ê°€] --- */
        let deferredPrompt;
        // ì•ˆë“œë¡œì´ë“œ/í¬ë¡¬ ë“±ì—ì„œ ì„¤ì¹˜ ê°€ëŠ¥í•  ë•Œ ì´ë²¤íŠ¸ ê°ì§€
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // ì„¤ì¹˜ ë²„íŠ¼ ë³´ì´ê²Œ í•˜ê¸°
            const btn = document.getElementById('btnInstallApp');
            if(btn) btn.style.display = 'flex';
        });

        // ì„¤ì¹˜ ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
        function installApp() {
            if (!deferredPrompt) {
                // ì•„ì´í°ì´ê±°ë‚˜ ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° ë“±
                alert("ë¸Œë¼ìš°ì € ë©”ë‰´ì˜ [ê³µìœ ] ë˜ëŠ” [ì„¤ì •] ë²„íŠ¼ì„ ëˆ„ë¥´ê³  \n'í™ˆ í™”ë©´ì— ì¶”ê°€'ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ“²\n(ì•„ì´í°ì€ ì‚¬íŒŒë¦¬ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤)");
                return;
            }
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the A2HS prompt');
                }
                deferredPrompt = null;
            });
        }

        /* --- [AI í•µì‹¬] ì˜¤í”„ë¼ì¸ ë°±ì—… ë‘ë‡Œ --- */
        const recipes = {
            "ë–¡ë³¶ì´": ["ë–¡", "ì–´ë¬µ", "ëŒ€íŒŒ", "ê³ ì¶”ì¥", "ì„¤íƒ•"],
            "ê¹€ì¹˜ì°Œê°œ": ["ê¹€ì¹˜", "ë¼ì§€ê³ ê¸°", "ë‘ë¶€", "ëŒ€íŒŒ"],
            "ëœì¥ì°Œê°œ": ["ëœì¥", "í˜¸ë°•", "ë‘ë¶€", "ì–‘íŒŒ"],
            "ë¯¸ì—­êµ­": ["ë¯¸ì—­", "ì†Œê³ ê¸°", "ì°¸ê¸°ë¦„"],
            "ì¹´ë ˆ": ["ì¹´ë ˆê°€ë£¨", "ê°ì", "ë‹¹ê·¼", "ì–‘íŒŒ"],
            "ë¼ë©´": ["ë¼ë©´", "ê³„ë€", "íŒŒ"],
            "ë¹„ë¹”ë°¥": ["ì½©ë‚˜ë¬¼", "ì‹œê¸ˆì¹˜", "ê³ ì¶”ì¥", "ê³„ë€", "ì°¸ê¸°ë¦„"]
        };

        function fallbackAI(text) {
            let reply = "ìŒ.. ê·¸ê±´ ì œê°€ ì˜ ëª¨ë¥´ëŠ” ë‚´ìš©ì´ì—ìš”. 'ë–¡ë³¶ì´ ì¬ë£Œ'ë‚˜ 'ì¼ì • ì¶”ê°€'ë¼ê³  ë§í•´ë³´ì„¸ìš”!";
            let action = null;
            for (const food in recipes) {
                if (text.includes(food)) {
                    action = { action: "add_shopping_multi", items: recipes[food] };
                    reply = `ğŸ‘¨â€ğŸ³ (ì˜¤í”„ë¼ì¸ ëª¨ë“œ) <b>${food}</b> ì¬ë£Œë¥¼ ì¥ë³´ê¸°ì— ë‹´ì•˜ì–´ìš”!`;
                    break;
                }
            }
            if (!action && (text.includes("ì¥ë³´ê¸°") || text.includes("ë‹´ì•„") || text.includes("ì¶”ê°€"))) {
                const item = text.replace("ì¥ë³´ê¸°","").replace("ì¶”ê°€","").replace("í•´ì¤˜","").replace("ë‹´ì•„ì¤˜","").replace("ì—","").trim();
                if(item) {
                    action = { action: "add_shopping", item: item };
                    reply = `ğŸ›’ (ì˜¤í”„ë¼ì¸ ëª¨ë“œ) <b>${item}</b> ì¶”ê°€ ì™„ë£Œ!`;
                }
            }
            if (text.includes("ì¼ì •")) {
                const today = new Date();
                let date = today.toISOString().split('T')[0];
                if(text.includes("ë‚´ì¼")) { today.setDate(today.getDate()+1); date = today.toISOString().split('T')[0]; }
                const title = text.replace("ì¼ì •","").replace("ì¶”ê°€","").replace("í•´ì¤˜","").replace("ë‚´ì¼","").replace("ì˜¤ëŠ˜","").trim();
                if(title) {
                    action = { action: "add_event", date: date, title: title };
                    reply = `ğŸ“… (ì˜¤í”„ë¼ì¸ ëª¨ë“œ) <b>${date}</b>ì— <b>${title}</b> ë“±ë¡!`;
                }
            }
            return { text: reply, action: action };
        }

        /* --- [AI í•µì‹¬] 2.5-flash ë‹¨ì¼ ëª¨ë¸ & ì¦‰ì‹œ ì˜¤í”„ë¼ì¸ ì „í™˜ --- */
        const AI_MODELS = ["gemini-2.5-flash"];

        async function sendChat() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if(!text) return;
            
            appendMessage(text, 'user');
            input.value = '';
            const loadingId = appendLoading();

            const systemPrompt = `
                ë„ˆëŠ” 'ì²´ë¦¬'ë¼ëŠ” ê°€ì¡± AI ë¹„ì„œì•¼. ì¹œê·¼í•œ ë°˜ë§ë¡œ ëŒ€ë‹µí•´.
                [ê¸°ëŠ¥ ì‹¤í–‰ ê·œì¹™]
                1. ì¼ì • ì¶”ê°€: {"action":"add_event", "date":"YYYY-MM-DD", "title":"ë‚´ìš©"} (ì˜¤ëŠ˜:${new Date().toISOString().split('T')[0]})
                2. ì¥ë³´ê¸° ì¶”ê°€: {"action":"add_shopping", "item":"ë¬¼ê±´"}
                3. ì—¬ëŸ¬ê°œ ì¶”ê°€: {"action":"add_shopping_multi", "items":["ë¬¼ê±´1", "ë¬¼ê±´2"]}
                4. ê·¸ ì™¸: ê·¸ëƒ¥ í…ìŠ¤íŠ¸ ëŒ€í™”.
                ì¤‘ìš”: "ë¹„ë¹”ë°¥ ì¬ë£Œ ì¶”ê°€" ê°™ì€ ìš”ì²­ì´ ì˜¤ë©´ "ë¹„ë¹”ë°¥ ì¬ë£Œ"ë¼ê³  ì“°ì§€ ë§ê³  ì‹¤ì œ ì¬ë£Œ(ì½©ë‚˜ë¬¼, ì‹œê¸ˆì¹˜ ë“±)ë¥¼ itemsì— ë‹´ì•„ì¤˜.
            `;

            let aiText = "";
            let success = false;

            // ëª¨ë¸ ì‹œë„
            for (const model of AI_MODELS) {
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: systemPrompt + "\nUser: " + text }] }] })
                    });
                    
                    if (res.status === 429) throw new Error("Too Many Requests");
                    if (!res.ok) throw new Error("API Error");

                    const data = await res.json();
                    aiText = data.candidates[0].content.parts[0].text;
                    success = true;
                    break; 
                } catch(e) {
                    console.warn(`Model ${model} failed (${e.message}). Switching to offline mode.`);
                }
            }

            document.getElementById(loadingId).remove();

            if(!success) {
                const fb = fallbackAI(text);
                aiText = fb.text;
                if (fb.action) {
                    if (fb.action.action === 'add_shopping_multi') fb.action.items.forEach(i => db.collection("family_shopping").add({ text: i, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() }));
                    else if (fb.action.action === 'add_shopping') db.collection("family_shopping").add({ text: fb.action.item, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                    else if (fb.action.action === 'add_event') db.collection("family_events").add({ date: fb.action.date, title: fb.action.title, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                }
                appendMessage(aiText, 'bot');
                return;
            }

            if (aiText.includes('{"action"')) {
                try {
                    const match = aiText.match(/\{"action":.*?\}/) || aiText.match(/\{"action":.*?\]\}/);
                    if (match) {
                        const cmd = JSON.parse(match[0]);
                        aiText = aiText.replace(match[0], "");
                        if (cmd.action === 'add_event') {
                            db.collection("family_events").add({ date: cmd.date, title: cmd.title, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                            aiText += `\nğŸ“… <b>${cmd.date}</b>ì— <b>${cmd.title}</b> ì¼ì • ë“±ë¡ ì™„ë£Œ!`;
                        } else if (cmd.action === 'add_shopping') {
                            db.collection("family_shopping").add({ text: cmd.item, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                            aiText += `\nğŸ›’ <b>${cmd.item}</b> ì¶”ê°€ ì™„ë£Œ!`;
                        } else if (cmd.action === 'add_shopping_multi') {
                            cmd.items.forEach(i => db.collection("family_shopping").add({ text: i, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() }));
                            aiText += `\nğŸ›’ <b>${cmd.items.join(", ")}</b> ëª¨ë‘ ë‹´ì•˜ì–´!`;
                        }
                    }
                } catch (e) {}
            }
            appendMessage(aiText, 'bot');
        }

        function appendMessage(t, s) {
            const box = document.getElementById('chatBody');
            box.innerHTML += `<div class="chat-msg msg-${s}">${marked.parse(t)}</div>`;
            box.scrollTop = box.scrollHeight;
        }
        function appendLoading() {
            const id = 'load-'+Date.now();
            document.getElementById('chatBody').innerHTML += `<div class="chat-msg msg-bot typing-indicator" id="${id}"><span></span><span></span><span></span></div>`;
            return id;
        }
        function toggleChat() { 
            const w = document.getElementById('chatWindow'); w.style.display = w.style.display === 'flex' ? 'none' : 'flex'; 
        }

        /* --- ê¸°ì¡´ ê¸°ëŠ¥ë“¤ --- */
        let familyData=[], selectedRole="";
        function loadFamily(){
            db.collection("family_members").orderBy("timestamp").onSnapshot(snap=>{
                familyData=[]; const con=document.getElementById('family-container'); const chips=document.getElementById('writerChips');
                con.innerHTML=""; chips.innerHTML=""; 
                if(snap.empty) chips.innerHTML=`<div style="padding:10px;font-size:14px;color:#aaa;">ê°€ì¡±ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!</div>`;
                snap.forEach(doc=>{
                    const d=doc.data(); familyData.push({id:doc.id,...d});
                    const imgHtml=d.imageUrl?`<img src="${d.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`:`<i class="fa-solid fa-user" style="font-size:30px;"></i>`;
                    con.innerHTML+=`<div class="mem-card"><button class="del-btn" onclick="delFamily('${doc.id}')" style="position:absolute;top:10px;right:10px;border:none;background:none;color:#999;"><i class="fa-solid fa-times"></i></button><div class="mem-pic">${imgHtml}</div><div class="mem-role">${d.role}</div><div class="mem-desc">${d.desc||'Yummy!'}</div></div>`;
                    const chk=selectedRole===d.role?'checked':'';
                    chips.innerHTML+=`<input type="radio" name="auth" id="c-${doc.id}" class="radio-hidden" value="${d.role}" onchange="selAuth(this)" ${chk}><label for="c-${doc.id}" class="writer-tag"><div style="width:24px;height:24px;border-radius:50%;overflow:hidden;background:#eee;border:1px solid #444;display:flex;align-items:center;justify-content:center;">${d.imageUrl?`<img src="${d.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`:`<i class="fa-solid fa-user" style="font-size:12px;"></i>`}</div> ${d.role}</label>`;
                });
                con.innerHTML+=`<div class="mem-card add-card" onclick="openFamModal()"><i class="fa-solid fa-plus-circle" style="font-size:40px;"></i><span style="font-family:'Jua';font-size:18px;">ê°€ì¡± ì¶”ê°€</span></div>`;
                updateHeaderProf();
            });
        }
        function selAuth(rd){ selectedRole=rd.value; updateHeaderProf(); }
        function updateHeaderProf(){ 
            const hp=document.getElementById('headerProfile'); 
            if(!selectedRole){ hp.innerHTML=`<i class="fa-solid fa-user"></i>`; return; }
            const mem=familyData.find(m=>m.role===selectedRole);
            if(mem&&mem.imageUrl) hp.innerHTML=`<img src="${mem.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`;
            else hp.innerHTML=`<i class="fa-solid fa-user"></i>`;
        }

        function getMemberImg(role) {
            const mem = familyData.find(m => m.role === role);
            if (mem && mem.imageUrl) return `<img src="${mem.imageUrl}" style="width:100%;height:100%;object-fit:cover;">`;
            return `<i class="fa-solid fa-user" style="font-size:14px;color:#bbb;"></i>`;
        }
        function getMyAvatarHtml() {
            if (!selectedRole) return `<i class="fa-solid fa-user" style="font-size:12px;color:#bbb;"></i>`;
            return getMemberImg(selectedRole);
        }

        let feedImg=null;
        function handleImageSelect(e){if(e.target.files[0])compressImage(e.target.files[0],500,d=>{feedImg=d;document.getElementById('imagePreview').src=d;document.getElementById('imagePreviewBox').style.display='block';});}
        function clearImage(){feedImg=null;document.getElementById('imageInput').value='';document.getElementById('imagePreviewBox').style.display='none';}
        function addPost(){
            if(!selectedRole) return alert("ëˆ„ê°€ ê¸€ì„ ì“°ë‚˜ìš”? ê°€ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”!"); const txt=document.getElementById('postContent').value, btn=document.getElementById('btnPost');
            if(!txt&&!feedImg) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); const mem=familyData.find(m=>m.role===selectedRole); btn.disabled=true; btn.innerText="ì €ì¥ ì¤‘...";
            db.collection("family_posts").add({
                author: selectedRole, authorImg: mem ? mem.imageUrl : null, content: txt, imageUrl: feedImg, likedBy: [], comments: [], timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(()=>{document.getElementById('postContent').value='';clearImage();btn.disabled=false;btn.innerText="ì—…ë¡œë“œ!"; window.scrollTo(0,0);}).catch(e=>{alert("ì‹¤íŒ¨!");btn.disabled=false;btn.innerText="ì—…ë¡œë“œ!";});
        }
        function likePost(id,n){db.collection("family_posts").doc(id).update({likes:(n||0)+1});}
        function delPost(id){if(confirm("ì‚­ì œ?"))db.collection("family_posts").doc(id).delete();}
        function toggleCmt(id){document.getElementById(`cmt-${id}`).classList.toggle('show');}
        function addCmt(id){const r=document.getElementById(`cAuth-${id}`).value,t=document.getElementById(`cInp-${id}`).value; if(!t)return; db.collection("family_posts").doc(id).update({comments:firebase.firestore.FieldValue.arrayUnion({author:r,text:t})});}

        let curDate=new Date(), events=[], curModDate=null;
        function loadCal(){
            const y=curDate.getFullYear(), m=curDate.getMonth(); document.getElementById('month-display').innerText=`${m+1}ì›”`;
            const f=new Date(y,m,1), l=new Date(y,m+1,0), con=document.getElementById('calendar-days'); con.innerHTML="";
            for(let i=0;i<f.getDay();i++)con.innerHTML+=`<div></div>`;
            for(let i=1;i<=l.getDate();i++){
                const dStr=`${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`, evs=events.filter(e=>e.date===dStr), hasEv=evs.length?`<div class="ev-badge"></div>`:'', tdy=new Date().toDateString()===new Date(y,m,i).toDateString()?'today':'';
                con.innerHTML+=`<div class="date-box ${tdy}" onclick="openEvModal('${dStr}')"><span class="date-num">${i}</span>${hasEv}</div>`;
            }
        }
        function moveMonth(n){curDate.setMonth(curDate.getMonth()+n);loadCal();}
        function openEvModal(d){curModDate=d; document.getElementById('modalDateDisplay').innerText=d; renderEvList(); document.getElementById('eventModal').style.display='flex';}
        function renderEvList(){const el=document.getElementById('eventList'), evs=events.filter(e=>e.date===curModDate); el.innerHTML=evs.length?"":"<li style='text-align:center;color:#999;'>ì¼ì • ì—†ìŒ</li>"; evs.forEach(e=>el.innerHTML+=`<li style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #ccc;"><span>${e.title}</span><i class="fa-solid fa-times" style="color:red;cursor:pointer;" onclick="delEv('${e.id}')"></i></li>`);}
        function saveEvent(){const t=document.getElementById('eventTitle').value; if(curModDate&&t) db.collection("family_events").add({date:curModDate,title:t,timestamp:firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{document.getElementById('eventTitle').value='';closeModal('eventModal');});}
        function delEv(id){if(confirm("ì‚­ì œ?"))db.collection("family_events").doc(id).delete();}
        db.collection("family_events").onSnapshot(s=>{events=[];s.forEach(d=>events.push({id:d.id,...d.data()}));loadCal();if(curModDate)renderEvList();});

        let famImg=null; function closeModal(id){document.getElementById(id).style.display='none';famImg=null;curModDate=null;}
        function openFamModal(){document.getElementById('familyModal').style.display='flex';}
        function handleFamImgSelect(e){if(e.target.files[0])compressImage(e.target.files[0],500,d=>{famImg=d;document.getElementById('famImgPreview').innerHTML=`<img src="${d}" style="width:100%;height:100%;object-fit:cover;">`;});}
        function saveFam(){
            const r=document.getElementById('famRole').value, n=document.getElementById('famName').value, d=document.getElementById('famDesc').value; if(!r)return alert("ì—­í•  ì…ë ¥!"); const btn=document.getElementById('btnSaveFam'); btn.disabled=true; btn.innerText="ì €ì¥ ì¤‘...";
            db.collection("family_members").add({role:r,name:n,desc:d,imageUrl:famImg,timestamp:firebase.firestore.FieldValue.serverTimestamp()})
            .then(()=>{closeModal('familyModal');btn.disabled=false;btn.innerText="ì¶”ê°€";document.getElementById('famRole').value='';document.getElementById('famName').value='';document.getElementById('famDesc').value='';document.getElementById('famImgInput').value='';document.getElementById('famImgPreview').innerHTML=`<i class="fa-solid fa-camera" style="font-size:30px;color:var(--text-choco);"></i>`;})
            .catch(e=>{alert("ì˜¤ë¥˜!");btn.disabled=false;btn.innerText="ì¶”ê°€";});
        }
        function delFamily(id){if(confirm("ì‚­ì œ?"))db.collection("family_members").doc(id).delete();}

        function loadShopping() {
            db.collection("family_shopping").orderBy("timestamp", "desc").onSnapshot(snap => {
                const list = document.getElementById('shopList');
                list.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const checkedClass = d.checked ? "checked" : "";
                    const checkColor = d.checked ? "on" : "";
                    list.innerHTML += `
                    <div class="shop-item ${checkedClass}">
                        <div style="display:flex; align-items:center;">
                            <div class="shop-check ${checkColor}" onclick="toggleShop('${doc.id}', ${!d.checked})"><i class="fa-solid fa-check" style="color:white; font-size:12px;"></i></div>
                            <span>${d.text}</span>
                        </div>
                        <i class="fa-solid fa-times shop-del" onclick="delShop('${doc.id}')"></i>
                    </div>`;
                });
            });
        }
        function addShopItem() {
            const inp = document.getElementById('shopInput');
            if(inp.value.trim()) {
                db.collection("family_shopping").add({ text: inp.value, checked: false, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                inp.value = '';
            }
        }
        function toggleShop(id, stat) { db.collection("family_shopping").doc(id).update({ checked: stat }); }
        function delShop(id) { if(confirm("ì‚­ì œ?")) db.collection("family_shopping").doc(id).delete(); }

        window.changeTab=function(id,el){document.querySelectorAll('.tab-section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));if(el)el.classList.add('active');window.scrollTo(0,0);}
        
        loadFeed(); loadCal(); loadFamily(); loadShopping();
    </script>
</body>
</html>